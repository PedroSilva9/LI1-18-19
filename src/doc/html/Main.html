<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Main</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Main.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption empty">&nbsp;</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Jos&#233; Pedro Silva &lt;a84577@uminho.pt&gt;<br />Rui Carvalho &lt;a89498@uminho.pt&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Main</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Main</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><h1>Introdu&#231;&#227;o</h1><p>Este &#233; o m&#243;dulo principal da tarefa 5. Esta tarefa trata-se de criar toda a parte gr&#225;fica do jogo recorrendo &#224; biblioteca Gloss. Desta forma todas as outras tarefas s&#227;o usadas para criar fun&#231;&#245;es fundamentais para esta tarefa.</p><h1>Objetivo</h1><p>Neste jogo &#233; poss&#237;vel jogar com 1 - 4 jogadores sendo que o n&#250;mero de jogadores escolhido no menu &#233; apenas referente aos tanques que s&#227;o controlados pelo utilizadores, os restantes ser&#227;o bots. Para al&#233;m disto uma das novas funcionalidades &#233; possibilidade do jogador poder apanhar powerups capazes
de aumentar o n&#250;mero de vidas a um tanque, aumentar o n&#250;mero de muni&#231;&#245;es ou dar teleport  para uma posi&#231;&#227;o aleat&#243;ria no mapa. </p><p>Esta tarefa relaciona os seguintes ficheiros cuja documenta&#231;&#227;o pode ser vista nos seguintes links:</p><ul><li>DesenhaJogo:  <code><a href="DesenhaJogo.html#v:hs">hs</a></code></li><li>ReageEvento:  <code><a href="ReageEvento.html#v:hs">hs</a></code></li><li>Typos:        <code><a href="Typos.html#v:hs">hs</a></code></li><li>MapasDefault: <code><a href="MapasDefault.html#v:hs">hs</a></code></li><li>Powerups:     <code><a href="Powerups.html#v:hs">hs</a></code></li><li>EstadoInicial:<code><a href="EstadoInicial.html#v:hs">hs</a></code></li></ul><h1>Conclus&#227;o</h1><p>Assim, com a realiza&#231;&#227;o desta tarefa, foi poss&#237;vel criar uma interface gr&#225;fica onde se pode jogar o jogo que at&#233; agora vinha sendo desenvolvido. Esta tarefa tamb&#233;m permitiu estabelecer uma liga&#231;&#227;o entre todos
as outras tarefas, permitindo visualizar todo o trabalho feito at&#233; ent&#227;o.</p><p>Esta tarefa tamb&#233;m permitiu a aprendizagem de como utilizar a biblioteca gloss de forma intensiva levando a criar uma interface visualmente apelativa e obter um jogo est&#225;vel. Apesar de todos os problemas enfrentados e erros obtidos, 
foi poss&#237;vel ultrapass&#225;-los obtendo maior conhecimento tanto na linguagem como na biblioteca gloss.</p><p>Todos os objetivos para esta tarefa foram cumpridos, sendo que, existem algumas partes que poderiam ficar um pouco melhor desenvolvidas no entanto achamos que o resultado final &#233; condizente com o que esperavamos.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:reageTempo">reageTempo</a> :: Float -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:applyPlay">applyPlay</a> :: [(Maybe <a href="LI11819.html#t:Jogada">Jogada</a>, Int)] -&gt; <a href="LI11819.html#t:Estado">Estado</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a></li><li class="src short"><a href="#v:checkVitoria">checkVitoria</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; (Bool, Int)</li><li class="src short"><a href="#v:main">main</a> :: IO ()</li><li class="src short"><a href="#v:dm">dm</a> :: Display</li><li class="src short"><a href="#v:fr">fr</a> :: Int</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:reageTempo" class="def">reageTempo</a> :: Float -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageTempo" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que controla o que acontece em todas as partes do programa ao longo do tempo.</p><p>Nesta utiliza-se a fun&#231;&#227;o <code><a href="Tarefa4_2018li1g027.html#v:tick">tick</a></code> da tarefa 4 (<code><a href="Tarefa4_20181li1g027.html#v:hs">hs</a></code>) aplicada ao estado do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> alterando-o.</p><pre>newEstado = tick . estado $ e</pre><p>Posteriormente &#233; criada a lista de posi&#231;&#245;es vazias do mapa e a lista da posi&#231;&#227;o dos powerups:</p><pre> allPos      = [(l,c) | l &lt;- [0 .. pred . length . mapaEstado $ newEstado], c &lt;- [0 .. pred . length . head . mapaEstado $ newEstado]]
 allPosGroup = groupN allPos $ length . head . mapaEstado $ newEstado
 vazias      = posVazia (mapaEstado newEstado) allPosGroup
 puPos       = map posicaoPowerUp $ powerups e
</pre><p>De seguida aplica-se as jogadas dos bots, obtendo-se os indices dos bots atrav&#233;s do par&#226;metros <code><a href="Typos.html#v:botIndex">botIndex</a></code> do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>, sendo que a fun&#231;&#227;o <code><a href="Tarefa6_2018li1g027.html#v:bot">bot</a></code> pode ser encontrada na tarefa 6.</p><pre>(botind, botPlay) = (botIndex e,map (flip bot newEstado) botind)</pre><p>Deste modo, cria-se um <strong>estadoGloss</strong> novo com o estado alterado pelas jogadas dos bots e os ticks. O par&#226;metro <code><a href="Typos.html#v:empty">empty</a></code> &#233; as posi&#231;&#245;es vazias retirando as posi&#231;&#245;es dos powerups e as posi&#231;&#245;es dos bots depois de se aplicar a fun&#231;&#227;o <code><a href="Tarefa4_2018li1g027.html#v:asSqr">asSqr</a></code>.</p><pre>newEstadoGloss = e{estado = newBotEst, empty = (vazias \\ puPos) \\ concatMap asSqr playersPos</pre><p>}
O par&#226;metro <code>ticks</code> aumenta em uma unidade e define-se uma vari&#225;vel winner para o segundo elementos do tuplo devolvido plea fun&#231;&#227;o <code><a href="Main.html#v:checkVitoria">checkVitoria</a></code> aplicada ao <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>.</p><pre>  newticks = succ . tickCounter $ e
  winPlr   = snd $ checkVitoria fetch{tickCounter = newticks}
</pre><p>J&#225; na fun&#231;&#227;o principal se for encontrado um vencedor e o utilizador nao estiver no menu nem no criador de mapas ent&#227;o devolve um novo <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> com <code><a href="Typos.html#v:menu">menu</a></code> com valor True, o indice do vencedor a imagem do <code><a href="Typos.html#v:tMenu">tMenu</a></code> correspondente ao &#237;ndice da imagem
do jogador vencedor que est&#225; guardada no par&#226;metro <code><a href="Typos.html#v:imagensMenu">imagensMenu</a></code>.</p><pre> if fst (checkVitoria fetch{tickCounter = newticks}) &amp;&amp; ((not . menu $ e) &amp;&amp; (not . criaMapa $ e))
    then e{menu = True, winner = winPlr, tMenu = (imagensMenu . imagens $ e) !! (winPlr + 6)}
    else fetch{tickCounter = newticks}  
</pre></div></div><div class="top"><p class="src"><a id="v:applyPlay" class="def">applyPlay</a> :: [(Maybe <a href="LI11819.html#t:Jogada">Jogada</a>, Int)] -&gt; <a href="LI11819.html#t:Estado">Estado</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a> <a href="#v:applyPlay" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que aplica uma lista de <code><a href="LI11819.html#t:Jogada">Jogada</a></code> a um <code><a href="LI11819.html#t:Estado">Estado</a></code> e devolve o <code><a href="LI11819.html#t:Estado">Estado</a></code> alterado.</p><p>A lista de jogadas &#233; filtrada pelas fun&#231;&#245;es que n&#227;o retornaram Nothing e passada para a fun&#231;&#227;o auxiliar que utiliza a fun&#231;&#227;o jogada da tarefa 2 usando o indice do jogador e o <code><a href="LI11819.html#t:Estado">Estado</a></code>.</p><h3>Exemplo de utiliza&#231;&#227;o:</h3><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let e = Estado (mapaInicial (5,5)) [Jogador (1,1) B 5 5 5] []
</code></strong>    applyPlay [(Just (Movimenta B),0),(Just (Dispara Canhao),0)] e
    Estado {mapaEstado = [[Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel],[Bloco Indestrutivel,Vazia,Vazia,Vazia,Bloco Indestrutivel],[Bloco Indestrutivel,Vazia,Vazia,Vazia,Bloco Indestrutivel],[Bloco Indestrutivel,Vazia,Vazia,Vazia,Bloco Indestrutivel],[Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel,Bloco Indestrutivel]], jogadoresEstado = [Jogador {posicaoJogador = (2,1), direcaoJogador = B, vidasJogador = 5, lasersJogador = 5, choquesJogador = 5}], disparosEstado = [DisparoCanhao {jogadorDisparo = 0, posicaoDisparo = (3,1), direcaoDisparo = B}]}
</pre></div></div><div class="top"><p class="src"><a id="v:checkVitoria" class="def">checkVitoria</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; (Bool, Int) <a href="#v:checkVitoria" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que verifica se num determinado <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> existe um jogador vencedor, ou seja, se s&#243; existe um vivo e devolve um tuplo em que o primeiro elemento &#233; True ou False dependo se existe ou n&#227;o vencedor e o segundo elemento &#233; o &#237;ndice no caso de existir jogador,
sendo que, no caso de n&#227;o existir permanece o &#237;ndice default que &#233; 0 (que apesar de ser o &#237;ndice de um jogador este s&#243; &#233; usado se o primeir elemento do tuplo for True).</p><p>A fun&#231;&#227;o guarda a lista de jogadores numa vari&#225;vel e usa a fun&#231;&#227;o <code>filter</code> para obter a lista de jogador <strong>com 0 vidas</strong>. Se o tamanho desta lista for igual a 3 ent&#227;o &#233; porque h&#225; um vencendor.</p><p>O indice do jogador vencedor &#233; obtido atrav&#233;s da fun&#231;&#227;o <code>CheckWhoWins</code> que recebe a lista de vidas e o valor 0 e retorna o &#237;ndice do jogador vencedor.</p><pre> checkWhoWins :: [Int] -&gt; Int -&gt; Int
 checkWhoWins [] ind = ind
 checkWhoWins (h:t) ind = if h &gt; 0 then ind else checkWhoWins t (succ ind)
</pre></div></div><h1 id="g:1">Main</h1><div class="top"><p class="src"><a id="v:main" class="def">main</a> :: IO () <a href="#v:main" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o principal do m&#243;dulo que carrega todas as imagens e as agrupa em listas.</p><p>Como se pode observar em <code><a href="Typos.html#t:Imagens">Imagens</a></code> existe 4 tipos de lista:</p><ul><li><code><a href="Typos.html#v:imagensMenu">imagensMenu</a></code> que guarda todas as imagens do menu;</li><li><code><a href="Typos.html#v:imagensJogo">imagensJogo</a></code> que guarda todas as imagens relativas ao jogo, como os tanques, tiros etc...</li><li><code><a href="Typos.html#v:imagensPowerUps">imagensPowerUps</a></code> que guarda as imagens referentes aos powerups;</li><li><code><a href="Typos.html#v:imagensTickCounter">imagensTickCounter</a></code> que tem os n&#250;meros de 0 a 9 em imagem.</li></ul></div></div><div class="top"><p class="src"><a id="v:dm" class="def">dm</a> :: Display <a href="#v:dm" class="selflink">#</a></p><div class="doc"><p>Dimens&#227;o nome e posi&#231;&#227;o do display do jogo no ecr&#227;.</p></div></div><div class="top"><p class="src"><a id="v:fr" class="def">fr</a> :: Int <a href="#v:fr" class="selflink">#</a></p><div class="doc"><p>Frame rate do jogo</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>
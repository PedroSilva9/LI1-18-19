<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ReageEvento</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_ReageEvento.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption empty">&nbsp;</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Jos&#233; Pedro Silva &lt;a84577@uminho.pt&gt;<br />Rui Carvalho &lt;a89498@uminho.pt&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">ReageEvento</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Reage a eventos do menu</a></li><li><a href="#g:2">Reage a eventos do criador de mapas.</a></li><li><a href="#g:3">Reage a eventos do jogo</a></li><li><a href="#g:4">Fun&#231;&#245;es complementares das fun&#231;&#245;es anteriores.</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Este m&#243;dulo cont&#233;m todos os reage evento que faz com que ao clicar-se numa tecla aconte&#231;a algo no jogo. Assim existem 3 tipos de reageEvento,
o reageEventoMenu, que corresponde a todos os eventos que acontecem no menu, o reageEventoCriaMapa que faz o mesmo mas na parte de criar um mapa personalizado e por fim
o reageEventoJogo, que controla o jogo.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:reageEvento">reageEvento</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:reageEventoMenu">reageEventoMenu</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:reageEventoMenuAux">reageEventoMenuAux</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; Picture -&gt; [Picture] -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:numeroJogador">numeroJogador</a> :: [Key]</li><li class="src short"><a href="#v:dMaps">dMaps</a> :: [Key]</li><li class="src short"><a href="#v:reageEventoCriaMapa">reageEventoCriaMapa</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:reageEventoJogo">reageEventoJogo</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:moveB">moveB</a> :: [Key]</li><li class="src short"><a href="#v:moveC">moveC</a> :: [Key]</li><li class="src short"><a href="#v:moveD">moveD</a> :: [Key]</li><li class="src short"><a href="#v:moveE">moveE</a> :: [Key]</li><li class="src short"><a href="#v:canhao">canhao</a> :: [Key]</li><li class="src short"><a href="#v:lasers">lasers</a> :: [Key]</li><li class="src short"><a href="#v:choque">choque</a> :: [Key]</li><li class="src short"><a href="#v:changeMap">changeMap</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Instrucao">Instrucao</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:changeJogadaEstado">changeJogadaEstado</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; Int -&gt; <a href="LI11819.html#t:Jogada">Jogada</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:resetGame">resetGame</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a></li><li class="src short"><a href="#v:verifyValidMap">verifyValidMap</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a> -&gt; Bool</li><li class="src short"><a href="#v:deleteOverlapPos">deleteOverlapPos</a> :: [<a href="LI11819.html#t:Posicao">Posicao</a>] -&gt; Bool</li><li class="src short"><a href="#v:changePlrEstado">changePlrEstado</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a></li><li class="src short"><a href="#v:verifyWindowSize">verifyWindowSize</a> :: (Int, Int) -&gt; (Int, Int)</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:reageEvento" class="def">reageEvento</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageEvento" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que recebe um evento e um <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>. Apartir deste retira o menu e o CriaMapa e apartir do seu valor de verdadeiro ou falso chama a funcao reageEvento correspondente.</p><p>Se o CriaMapa tem valor True e o menu False ent&#227;o a fun&#231;&#227;o chama o <code><a href="ReageEvento.html#v:reageEventoCriaMapa">reageEventoCriaMapa</a></code>.</p><p>Se o CriaMapa tem valor False e o menu True ent&#227;o, se existe algum vencedor (se o &#237;ndice do winner no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> &#233; maior ou igual a 0) chama a fun&#231;&#227;o <code><a href="ReageEvento.html#v:reageEventoMenu">reageEventoMenu</a></code> mas com a picture que corresponde &#224; vit&#243;ria do jogador correspondente ao indice.
Sen&#227;o apenas chama a fun&#231;&#227;o <code><a href="ReageEvento.html#v:reageEventoMenu">reageEventoMenu</a></code>.</p><p>Se o CriaMapa tem valor False e o menu False ent&#227;o a fun&#231;&#227;o chama o <code><a href="ReageEvento.html#v:reageEventoJogo">reageEventoJogo</a></code>.</p></div></div><h1 id="g:1">Reage a eventos do menu</h1><div class="top"><p class="src"><a id="v:reageEventoMenu" class="def">reageEventoMenu</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageEventoMenu" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o Principal que passa para a fun&#231;&#227;o <code><a href="ReageEvento.html#v:reageEventoMenuAux">reageEventoMenuAux</a></code> o evento o <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> a picture do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual e a lista de imagens guardadas no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:reageEventoMenuAux" class="def">reageEventoMenuAux</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; Picture -&gt; [Picture] -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageEventoMenuAux" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o auxiliar da fun&#231;&#227;o ReageEventoMenu que de acordo com a tecla clicada muda de picture no parametro tMenu no EstadoGloss apresendo-a no ecr&#227; </p><p>A fun&#231;&#227;o verifica na lista de imagens do parametro imagens do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual e de acordo com o indice da picture na lista e o evento devolve a nova picture.</p><pre>reageEventoMenuAux :: Event -&gt; EstadoGloss -&gt; Picture -&gt; [Picture] -&gt; EstadoGloss
reageEventoMenuAux (EventKey (SpecialKey KeyUp) Down _ _) e pic img = case elemIndex pic img of
                                                                        Just 1  -&gt; e{tMenu = img !! 2}
                                                                        Just 2  -&gt; e{tMenu = img !! 1}
                                                                        Just 4  -&gt; e{tMenu = img !! 5}
                                                                        Just 10 -&gt; e{tMenu = img !! 6}
                                                                        Just 11 -&gt; e{tMenu = img !! 7}
                                                                        Just 12 -&gt; e{tMenu = img !! 8}
                                                                        Just 13 -&gt; e{tMenu = img !! 9}
                                                                        _ -&gt; e
</pre><p>Um dos problemas enfrentados foi a situa&#231;&#227;o em que um jogador ganhava e por isso a fun&#231;&#227;o ia buscar a imagem correspondente &#224; vit&#243;ria do jogador com a op&#231;&#227;o de voltar ao menu selecionada, 
uma vez que tamb&#233;m existia a op&#231;&#227;o de <em>restart</em> nesse menu, quando o utilizador clicava na seta para baixo selecionava a op&#231;&#227;o de <em>restart</em> pois a verifica&#231;&#227;o se um jogador ganha ou n&#227;o &#233; feita no reageTempo e como
o indice do jogador vencedor era o mesmo, a fun&#231;&#227;o estava sempre a devolver um <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> no qual a imagem no <code><a href="Typos.html#v:tMenu">tMenu</a></code> &#233; a do jogador vencedor com a op&#231;&#227;o de voltar ao menu selecionada.</p><p>Assim, para corrigir esta situa&#231;&#227;o quando o utilizador clica na seta para baixo para mudar da op&#231;&#227;o de ir para o menu para a op&#231;&#227;o de restart, o indice do jogador vencedor no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>
passa a ser -1 de forma a que j&#225; n&#227;o seja invocada a imagem inicial do jogador vencedor.</p><pre>reageEventoMenuAux (EventKey (SpecialKey KeyDown) Down _ _) e pic img = case elemIndex pic img of
                                                                          Just 1 -&gt; e{tMenu = img !! 2}
                                                                          Just 2 -&gt; e{tMenu = img !! 1}
                                                                          Just 5 -&gt; e{tMenu = img !! 4}
                                                                          Just 6 -&gt; e{tMenu = img !! 10,winner = -1}
                                                                          Just 7 -&gt; e{tMenu = img !! 11,winner = -1}
                                                                          Just 8 -&gt; e{tMenu = img !! 12,winner = -1}
                                                                          Just 9 -&gt; e{tMenu = img !! 13,winner = -1}
                                                                          _ -&gt; e

</pre><p>Utilizando a lista de imagens do menu que est&#225; no par&#226;metro <code><a href="Typos.html#t:Imagens">Imagens</a></code> do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> e clicando na tecla <em>Enter</em> quando o utilizador est&#225; na imagem de indice <strong>0</strong> ou seja no menu de entrada, esta passa para o menu que apresenta as op&#231;&#245;es de criar um mapa
ou jogar com um mapa pr&#233;-definido.</p><pre>Just 0  -&gt; e{tMenu = img !! 1}</pre><p>Se o utlizador escolher a op&#231;&#227;o de criar um mapa personalizado ent&#227;o o valor do <code><a href="Typos.html#v:criaMapa">criaMapa</a></code> no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> passa a verdadeiro e o valor do <code><a href="Typos.html#v:menu">menu</a></code> passa para falso, entrando por isso no criador de mapas.</p><pre>Just 1  -&gt; e{criaMapa = True,menu = False}</pre><p>Se o mapa criado pelo utilizador for inv&#225;lido ent&#227;o a imagem atual ser&#225; a de indice 4, tendo como op&#231;&#227;o assinalada, a de voltar ao menu inicial. Se o utilizador pressionar a tecla <em>Enter</em> ent&#227;o o jogo volta ao menu inicial chamando o <code><a href="EstadoInicial.html#v:estadoI">estadoI</a></code> passando como argumento a lista de imagens do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual.</p><pre>Just 4  -&gt; estadoI $ imagens e</pre><p>Por outro lado se o mapa for inv&#225;lido e a op&#231;&#227;o destacada for a de tentar de novo (<em>Retry</em>) ent&#227;o o utilizador &#233; levado ao criador de Mapas, sendo que a fun&#231;&#227;o altera o estado para colocar o <code><a href="Typos.html#v:criaMapa">criaMapa</a></code> verdadeiro e voltando a colocar a lista de <code>acoes</code> e o <code><a href="Typos.html#v:editor">editor</a></code> tal como est&#227;o no <code><a href="EstadoInicial.html#v:estadoI">estadoI</a></code>.</p><pre>Just 5  -&gt; e{criaMapa = True, menu = False,acoesMapa = [], editor = instrucao Desenha $ editorInicial []}</pre><p>Se a imagem for a imagem de vit&#243;ria de qualquer jogador e a op&#231;&#227;o selecionada seja a de voltar ao menu inicial, ou seja, as imagens de indice 6,7,8,9 ent&#227;o a fun&#231;&#227;o chama o <code><a href="EstadoInicial.html#v:estadoI">estadoI</a></code> passando como argumento a lista de imagens do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual. Assim o jogo volta ao menu inicial.</p><pre> Just 6  -&gt; estadoI $ imagens e
 Just 7  -&gt; estadoI $ imagens e
 Just 8  -&gt; estadoI $ imagens e
 Just 9  -&gt; estadoI $ imagens e
</pre><p>Por outro lado se o jogo estiver no menu de vit&#243;ria de qualquer jogador mas com a op&#231;&#227;o de dar <em>restart</em> ao jogo em destaque e o utilizador pressionar <em>Enter</em> ent&#227;o a fun&#231;&#227;o <code><a href="ReageEvento.html#v:resetGame">resetGame</a></code> &#233; chamada passando como argumento o <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual. </p><pre> Just 10 -&gt; resetGame e
 Just 11 -&gt; resetGame e
 Just 12 -&gt; resetGame e
 Just 13 -&gt; resetGame e
</pre><p>Ap&#243;s a cria&#231;&#227;o de um mapa este &#233; testado pela fun&#231;&#227;o <code><a href="ReageEvento.html#v:verifyValidMap">verifyValidMap</a></code>, passando como argumento o <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> e o resultado da fun&#231;&#227;o <code><a href="ReageEvento.html#v:changePlrEstado">changePlrEstado</a></code> que altera a lista de jogadores do estado.</p><p>Se o mapa for v&#225;lido ent&#227;o altera os par&#226;metros que e passa para o jogo sen&#227;o devolve uma imagem que diz que o mapa &#233; inv&#225;lido e se o utilizador quer voltar a tentar ou voltar ao menu.</p></div></div><div class="top"><p class="src"><a id="v:numeroJogador" class="def">numeroJogador</a> :: [Key] <a href="#v:numeroJogador" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que selecionam a quantidade de jogadores.</p></div></div><div class="top"><p class="src"><a id="v:dMaps" class="def">dMaps</a> :: [Key] <a href="#v:dMaps" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que selecionam o mapa pr&#233;-definido. </p></div></div><h1 id="g:2">Reage a eventos do criador de mapas.</h1><div class="top"><p class="src"><a id="v:reageEventoCriaMapa" class="def">reageEventoCriaMapa</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageEventoCriaMapa" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que controla os eventos do criador de mapas. Esta fun&#231;&#227;o mediante a tecla que &#233; clicada chama a fun&#231;&#227;o <code><a href="ReageEvento.html#v:changeMap">changeMap</a></code> passando como argumento o <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual e a instru&#231;&#227;o correspondente a essa tecla</p><p>Quando a tecla pressionada &#233; o <em>Enter</em> ent&#227;o o mapa alterado de acordo com as instrucoes &#233; passado para o para o par&#226;metro <code><a href="Typos.html#v:estado">estado</a></code> presente no <code>EstadoAtual</code>, o <code><a href="Typos.html#v:menu">menu</a></code> passa a verdadeiro e o <code><a href="Typos.html#v:criaMapa">criaMapa</a></code> e a imagem no <code><a href="Typos.html#v:tMenu">tMenu</a></code> &#233; a de escolha da quantidade de jogadores.</p><pre>reageEventoCriaMapa (EventKey (SpecialKey KeyEnter) Down _ _) e = e{estado = Estado{mapaEstado = constroi .acoesMapa $ e,jogadoresEstado = [],disparosEstado =[]}, tMenu = (imagensMenu . imagens $ e) !! 3,menu = True, criaMapa = False,tickCounter = 0}</pre><p>Se a imagem for redimensionada, algo que &#233; verificado pelo <code>EventResize</code> ent&#227;o a fun&#231;&#227;o <code><a href="ReageEvento.html#v:verifyWindowSize">verifyWindowSize</a></code> &#233; chamada devolvendo um tamanho da janela. A utiliza&#231;&#227;o deste evento &#233; bastante &#250;til na medida em que permite redimensionar certas <em>pictures</em> tornando-as proporcionais ao tamanho da tela.</p><pre>reageEventoCriaMapa (EventResize newWinSize) e = e{windowSize = verifyWindowSize newWinSize}</pre></div></div><h1 id="g:3">Reage a eventos do jogo</h1><div class="top"><p class="src"><a id="v:reageEventoJogo" class="def">reageEventoJogo</a> :: Event -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:reageEventoJogo" class="selflink">#</a></p><div class="doc"><p>Esta fun&#231;&#227;o &#233; respons&#225;vel pelo movimento dos tanques e o disparar das armas clicando em determinadas teclas.</p><p>Se a tecla pressionada pertencer a uma das seguintes listas:</p><pre> moveB  = [Char <code>s</code> ,SpecialKey KeyDown  ,Char <code>k</code> ,Char '5']
 moveC  = [Char <code>w</code> ,SpecialKey KeyUp    ,Char <code>i</code> ,Char '8']
 moveD  = [Char <code>d</code> ,SpecialKey KeyRight ,Char <code>l</code> ,Char '6']
 moveE  = [Char <code>a</code> ,SpecialKey KeyLeft  ,Char <code>j</code> ,Char '4']
 canhao = [Char '1' ,Char ','            ,Char <code>o</code> ,Char '0']
 lasers = [Char '2' ,Char <code>.</code>            ,Char <code>p</code> ,Char '7']
 choque = [Char '3' ,Char <code>-</code>            ,Char <code>+</code> ,Char '9']

</pre><p>Ent&#227;o a fun&#231;&#227;o <code><a href="ReageEvento.html#v:changeJogadaEstado">changeJogadaEstado</a></code> &#233; chamada passando como argumento o <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual o indice dessa tecla na lista a que pertence e a jogada correspondente. Este indice vai corresopnder ao jogador que &#233; selecionada para fazer a jogada. 
Sen&#227;o pertencer a nenhuma das listas ent&#227;o devolve o mesmo <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code></p><p>Da mesma forma que acontece nas fun&#231;&#245;es <code><a href="ReageEvento.html#v:reageEventoMenuAux">reageEventoMenuAux</a></code> e <code><a href="ReageEvento.html#v:reageEventoCriaMapa">reageEventoCriaMapa</a></code> a altera&#231;&#227;o da dimens&#227;o da tela tamb&#233;m &#233; registado aplicando a fun&#231;&#227;o <code><a href="ReageEvento.html#v:verifyWindowSize">verifyWindowSize</a></code>, sendo que, esta devolve um novo tamanho da tela do jogo e guarda-o no par&#226;metro <code><a href="Typos.html#v:windowSize">windowSize</a></code> do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>.</p><p>Pelos mesmo motivos, esta funcionalidade permite resolver certos problemas em termos do tamanho de algumas figuras e assim &#233; poss&#237;vel ajust&#225;-las ao tamanho da tela do jogo.</p></div></div><div class="top"><p class="src"><a id="v:moveB" class="def">moveB</a> :: [Key] <a href="#v:moveB" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Movimenta B'</p></div></div><div class="top"><p class="src"><a id="v:moveC" class="def">moveC</a> :: [Key] <a href="#v:moveC" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Movimenta C'</p></div></div><div class="top"><p class="src"><a id="v:moveD" class="def">moveD</a> :: [Key] <a href="#v:moveD" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Movimenta D'</p></div></div><div class="top"><p class="src"><a id="v:moveE" class="def">moveE</a> :: [Key] <a href="#v:moveE" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Movimenta E'</p></div></div><div class="top"><p class="src"><a id="v:canhao" class="def">canhao</a> :: [Key] <a href="#v:canhao" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Dispara Canhao'</p></div></div><div class="top"><p class="src"><a id="v:lasers" class="def">lasers</a> :: [Key] <a href="#v:lasers" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Dispara Laser'</p></div></div><div class="top"><p class="src"><a id="v:choque" class="def">choque</a> :: [Key] <a href="#v:choque" class="selflink">#</a></p><div class="doc"><p>Lista de teclas que realizam a jogada 'Dispara Choque'</p></div></div><h1 id="g:4">Fun&#231;&#245;es complementares das fun&#231;&#245;es anteriores.</h1><div class="top"><p class="src"><a id="v:changeMap" class="def">changeMap</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Instrucao">Instrucao</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:changeMap" class="selflink">#</a></p><div class="doc"><p>Esta fun&#231;&#227;o recebe um <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> e uma instru&#231;&#227;o e altera o mapa do editor de modo a que o mapa seja construido de acordo com a lista de <code><a href="Typos.html#v:acoesMapa">acoesMapa</a></code> anterior concatenada com a nova <code><a href="Tarefa1_2018li1g027.html#v:instrucao">instrucao</a></code> e a <code><a href="Tarefa1_2018li1g027.html#v:instrucao">instrucao</a></code> <code><a href="LI11819.html#v:Desenha">Desenha</a></code>, com recurso &#224; fun&#231;&#227;o <code><a href="Tarefa1_2018li1g027.html#v:constroi">constroi</a></code>.</p><p>O <code><a href="LI11819.html#v:Desenha">Desenha</a></code> &#233; usado pois permite ao tetr&#243;mino atual aparecer no ecr&#227;. </p><pre>newEditor = edit{mapaEditor = constroi $ acoes ++ [instrucao,Desenha]}</pre><p>Por fim a <code><a href="Tarefa1_2018li1g027.html#v:instrucao">instrucao</a></code> &#233; a adicionada &#224; lista de <code><a href="Typos.html#v:acoesMapa">acoesMapa</a></code>, sendo que, a fun&#231;&#227;o devolve um novo <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> com todas estas altera&#231;&#245;es. </p><pre>newAcoes  = acoes ++ [instrucao]</pre></div></div><div class="top"><p class="src"><a id="v:changeJogadaEstado" class="def">changeJogadaEstado</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; Int -&gt; <a href="LI11819.html#t:Jogada">Jogada</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:changeJogadaEstado" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que permite alterar um estado de acordo com a jogada e o indice do jogador.</p><p>Se um o indice do jogador for maior que o tamanho da lista ou entao esse indice for o de um bot ent&#227;o o estado permanece o mesmo, pois a jogada do bot &#233; apenas aplicada na fun&#231;&#227;o <code>ReageTempo</code>.</p><p>Por outro lado se n&#227;o se verificar nenhuma das condi&#231;&#245;es anteriores ent&#227;o o estado &#233; alterado atrav&#233;s da fun&#231;&#227;o <code><a href="Tarefa2_2018li1g027.html#v:jogada">jogada</a></code> da tarefa 2, sendo que, &#233; este estado que &#233; devolvido.</p></div></div><div class="top"><p class="src"><a id="v:resetGame" class="def">resetGame</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> <a href="#v:resetGame" class="selflink">#</a></p><div class="doc"><p>fun&#231;&#227;o que permite fazer <em>restart</em> ao jogo voltando a construir o mapa inicial, usando a fun&#231;&#227;o <code><a href="Tarefa1_2018li1g027.html#v:constroi">constroi</a></code> e as acoes do mapa guardadas no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code>. </p><pre>constroi . acoesMapa $ e</pre><p>A lista &#233; extraida do estado presente no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> atual e &#233; usada para construir um novo estado com o mapa previamente mencionado e uma lista de disparos vazia.</p><pre>newest    = Estado (constroi . acoesMapa $ e) jogList []</pre><p>Desta forma &#233; devolvido um <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> que cont&#233;m o newest e certos valores s&#227;o colocados de forma a serem compat&#237;veis com o inicio do jogo.</p><pre>e{estado = newEstado, menu = False, powerups = [], powerUpCounter = 0,empty = [] , rnd = mkStdGen 5,tickCounter = 0,winner = -1}</pre></div></div><div class="top"><p class="src"><a id="v:verifyValidMap" class="def">verifyValidMap</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a> -&gt; Bool <a href="#v:verifyValidMap" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que testa se um dado mapa criado &#233; v&#225;lido ou n&#227;o. Esta fun&#231;&#227;o foi feita para os casos em que o utilizador cria mapas em que o n&#250;mero de posi&#231;&#245;es onde cabem tanques n&#227;o chega para a quantidade de tanques, ou ent&#227;o se vai existir alguma situa&#231;&#227;o em que o tanque tenha alguma parte sobreposta a outro tanque.</p><p>Numa primeira fase &#233; criada uma lista onde se chama a fun&#231;&#227;o <code><a href="DesenhaJogo.html#v:checkPosVazia">checkPosVazia</a></code> passando como argumento o mapa presente no <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> que vai devolver a lista de posicoes vazias do mapa. Posteriormente a esta lista aplica-se a fun&#231;&#227;o <code>posOndeCabemTaques</code> onde a lista
devolvida &#233; apenas as posicoes vazias onde o tanque de facto cabe em todas as suas 4 posi&#231;&#245;es.</p><pre> mapa                = mapaEstado . estado $ estGloss
 emptyPosList        = posOndeCabemTanques $ checkPosVazia mapa
</pre><p>a lista de jogadores &#233; extra&#237;da do <code><a href="LI11819.html#t:Estado">Estado</a></code> e &#233; aplicada a fun&#231;&#227;o <code>nub</code> que elimina posicoes iguais da lista. Esta &#233; uma forma de verificar se a lista ap&#243;s aplicada a fun&#231;&#227;o <code>nub</code> tem o mesmo tamanho ou n&#227;o que a anterior, podendo assim concluir que havia jogadores com posi&#231;&#245;es sobrepostas e assim a fun&#231;&#227;o retorna False.</p><pre> posJog = map posicaoJogador listJog
 posJogSemRepeticoes = nub posJog
</pre><p>De facto, tamb&#233;m &#233; usada a fun&#231;&#227;o <code><a href="ReageEvento.html#v:deleteOverlapPos">deleteOverlapPos</a></code> aplicada &#224; lista de jogadores para que resolva a situ&#231;&#227;o mencionada anteriormente no qual alguns tanques poderiam ter alguma das suas 4 posi&#231;&#245;es sobrepostas a outro tanque.</p><pre>overlapJogPos = deleteOverlapPos posJog</pre><p>A posicao de jogadores &#233; passada como argumento para a fun&#231;&#227;o auxiliar que verifica se alguma das posicoes do jogadores &#233; (0,0). Esta posicao &#233; o que fun&#231;&#227;o <code>calculaPosMaisProx</code>, usada para calcular a posicao de cada tanque, devolve no caso da lista das posicoes vazias ondem cabem tanques ser vazia.
<code>
 aux :: [Posicao] -&gt; Bool
 aux [] = True
 aux (h:t) = h /= (0,0) &amp;&amp; aux t
</code></p></div></div><div class="top"><p class="src"><a id="v:deleteOverlapPos" class="def">deleteOverlapPos</a> :: [<a href="LI11819.html#t:Posicao">Posicao</a>] -&gt; Bool <a href="#v:deleteOverlapPos" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que testa se algum tanque tem alguma das suas 4 posi&#231;&#245;es sobrepostas a outro tanque.</p><p>Com recurso &#224; fun&#231;&#227;o <code>any</code> e <code>elem</code> a lista de posicoes dos jogadores e a posi&#231;&#227;o de um dos tanques &#233; passada &#224; fun&#231;&#227;o auxiliar que usa a fun&#231;&#227;o <code>ConcatMap</code> e <code><a href="Tarefa4_2018li1g027.html#v:asSqr">asSqr</a></code> para fazer a lista com todas as 4 posicoes de cada jogador tirando o jogador que vai ser testado.</p><pre> nposl = concatMap asSqr (posl \\ [h])</pre><p>As 4 posi&#231;&#245;es do jogador que n&#227;o pertence &#224; lista tamb&#233;m s&#227;o calculadas.</p><pre>asSqrPos = asSqr h </pre><p>Assim verifica-se se alguma da posi&#231;&#227;o da lista nposl pertence &#224; lista das 4 posi&#231;&#245;es do tanque (asSqrPos)</p><pre>any (flip elem asSqrPos) nposl</pre></div></div><div class="top"><p class="src"><a id="v:changePlrEstado" class="def">changePlrEstado</a> :: <a href="Typos.html#t:EstadoGloss">EstadoGloss</a> -&gt; <a href="LI11819.html#t:Estado">Estado</a> <a href="#v:changePlrEstado" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que com um <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> devolve um <code><a href="LI11819.html#t:Estado">Estado</a></code> que contem o mapa e a lista de disparos do <code><a href="Typos.html#t:EstadoGloss">EstadoGloss</a></code> mas com uma nova lista de jogadores proveniente da fun&#231;&#227;o <code><a href="DesenhaJogo.html#v:posTank">posTank</a></code> aplicada ao <code><a href="LI11819.html#t:Estado">Estado</a></code>.</p><pre> (Estado mapa jogList dispList) = estado e
 newjogList = posTank e
 changePlrEstado e = Estado mapa newjogList dispList
</pre></div></div><div class="top"><p class="src"><a id="v:verifyWindowSize" class="def">verifyWindowSize</a> :: (Int, Int) -&gt; (Int, Int) <a href="#v:verifyWindowSize" class="selflink">#</a></p><div class="doc"><p>Fun&#231;&#227;o que recebe um tuplo e verica se a raz&#227;o entre o primeiro elemento do tuplo e o segundo &#233; superior, inferior ou ent&#227;o se econtra entre os valores minSize e maxSize.</p><pre> minSize = 1280 / 720
 maxSize = 1920 / 1080
 currentSize = fromIntegral a / fromIntegral b
</pre><p>Se o valor da raz&#227;o for inferior ao minSize ent&#227;o o valor devolvido &#233; (1280,720):</p><pre>currentSize &lt;= minSize = (1280,720</pre><p>Se for superio ent&#227;o &#233; devolvido (1920,1080):</p><pre>currentSize &gt;= maxSize = (1920,1080)</pre><p>Se estiver dentro do intervalo ent&#227;o o valor devolvido &#233; o da pr&#243;pria raz&#227;o:</p><pre>otherwise = (a,b)</pre><p>Esta fun&#231;&#227;o foi criada para n&#227;o redimensionar certas figuras abaixo de determinadas dimens&#245;es da tela, impedindo problemas visuais que possam acontecer no jogo, como por exemplo, a sobreposi&#231;&#227;o da picture do estado de cada jogador com o mapa do jogo.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>